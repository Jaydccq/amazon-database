{% extends "layout.html" %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <!-- Breadcrumb and Main Content Column -->
        <div class="col-md-8">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{{ url_for('index.index') }}">Home</a></li>
                    <li class="breadcrumb-item"><a href="{{ url_for('product.category', category_id=product.category_id) }}">{{ product.category_name }}</a></li>
                    <li class="breadcrumb-item active" aria-current="page">{{ product.name }}</li>
                </ol>
            </nav>

            <!-- Product Main Card -->
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-white py-3 border-bottom">
                    <h1 class="h3 mb-0 fw-bold">{{ product.name }}</h1>
                </div>
                <div class="card-body">
                    <div class="row">
                        <!-- Product Image Gallery -->
                        <div class="col-md-5 mb-4">
                            <div class="position-relative">
                                {% if product.image %}
                                <img src="{{ product.image }}" alt="{{ product.name }}" class="img-fluid rounded shadow-sm mb-2">
                                {% else %}
                                <div class="bg-light text-center p-5 rounded">
                                    <i class="fas fa-image fa-4x text-muted"></i>
                                    <p class="mt-3 text-muted">No image available</p>
                                </div>
                                {% endif %}

                                <!-- Sales Badge (if product is popular) -->
                                <div class="position-absolute top-0 end-0 m-2">
                                    <span class="badge bg-danger">Best Seller</span>
                                </div>
                            </div>

                            <!-- Thumbnail Gallery (for multiple images) -->
                            <div class="row g-2 mt-1">
                                <div class="col-3">
                                    <img src="{{ product.image }}" class="img-thumbnail" alt="Thumbnail">
                                </div>
                                <div class="col-3">
                                    <div class="bg-light rounded img-thumbnail d-flex align-items-center justify-content-center">
                                        <i class="fas fa-plus text-muted"></i>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Product Details -->
                        <div class="col-md-7">
                            <!-- Rating and Reviews Summary -->
                            <div class="d-flex align-items-center mb-3">
                                <div class="me-2">
                                    <span class="h4 text-warning fw-bold">4.7</span>
                                    <span class="text-muted">/5</span>
                                </div>
                                <div class="me-3">
                                    <i class="fas fa-star text-warning"></i>
                                    <i class="fas fa-star text-warning"></i>
                                    <i class="fas fa-star text-warning"></i>
                                    <i class="fas fa-star text-warning"></i>
                                    <i class="fas fa-star-half-alt text-warning"></i>
                                </div>
                                <div>
                                    <span class="text-muted">{{ product.review_count }} reviews</span>
                                </div>
                            </div>

                            <!-- Product Pricing Range -->
                            <div class="mb-3">
                                <h3 class="text-primary fw-bold">
                                    ${{ "%.2f"|format(product.inventory[0].unit_price if product.inventory else 0.00) }}
                                    {% if product.inventory and product.inventory|length > 1 %}
                                    <small class="text-muted">- ${{ "%.2f"|format(product.inventory[-1].unit_price) }}</small>
                                    {% endif %}
                                </h3>
                            </div>

                            <!-- Product Description -->
                            <h5 class="text-dark mb-3">Description</h5>
                            <p>{{ product.description }}</p>

                            <!-- Product Specifications -->
                            <div class="mb-3">
                                <h5 class="text-dark">Specifications</h5>
                                <div class="row">
                                    <div class="col-md-6">
                                        <ul class="list-unstyled mb-0">
                                            <li class="mb-2">
                                                <i class="fas fa-tag text-secondary me-2"></i>
                                                <span class="fw-medium">Category:</span>
                                                <span class="badge bg-secondary">{{ product.category_name }}</span>
                                            </li>
                                            <li class="mb-2">
                                                <i class="fas fa-user text-secondary me-2"></i>
                                                <span class="fw-medium">Manufacturer:</span>
                                                <span>{{ product.owner_name }}</span>
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="col-md-6">
                                        <ul class="list-unstyled mb-0">
                                            <li class="mb-2">
                                                <i class="fas fa-calendar text-secondary me-2"></i>
                                                <span class="fw-medium">Added:</span>
                                                <span>{{ product.created_at.strftime('%b %d, %Y') if product.created_at else 'N/A' }}</span>
                                            </li>
                                            <li class="mb-2">
                                                <i class="fas fa-shopping-cart text-secondary me-2"></i>
                                                <span class="fw-medium">Sellers:</span>
                                                <span>{{ product.inventory|length if product.inventory else 0 }}</span>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <hr class="my-4">

                            <!-- Purchase Options -->
                            {% if product.inventory %}
                            <h5 class="text-dark mb-3">Purchase Options</h5>
                            <div class="list-group shadow-sm">
                                {% for item in product.inventory %}
                                <div class="list-group-item seller-option {% if loop.first %} border-start border-3 border-primary{% endif %}"
                                     data-seller-id="{{ item.seller_id }}"
                                     data-seller-name="{{ item.seller_name }}"
                                     data-seller-rating="4.8"
                                     data-seller-reviews="56"
                                     data-seller-satisfaction="98"
                                     data-seller-response="24h"
                                     data-seller-products="256">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <div class="d-flex align-items-center mb-1">
                                                <strong class="me-2">{{ item.seller_name }}</strong>
                                                {% if loop.first %}
                                                <span class="badge bg-primary seller-badge">Best Price</span>
                                                {% endif %}
                                            </div>
                                            <div class="d-flex align-items-center">
                                                <span class="me-3 text-success">
                                                    <i class="fas fa-check-circle me-1"></i>
                                                    In Stock: {{ item.quantity }} units
                                                </span>


                                            </div>
                                        </div>
                                        <div>
                                            <h4 class="text-primary mb-2">${{ "%.2f"|format(item.unit_price) }}</h4>
                                            {% if current_user.is_authenticated %}
                                            <form action="{{ url_for('cart.add_to_cart') }}" method="POST" class="seller-form">
                                                <div class="input-group">
                                                    <input type="hidden" name="product_id" value="{{ product.id }}">
                                                    <input type="hidden" name="seller_id" value="{{ item.seller_id }}">
                                                    <input type="number" name="quantity" value="1" min="1" max="{{ item.quantity }}"
                                                        class="form-control form-control-sm">
                                                    <button type="submit" class="btn btn-primary select-seller-btn">
                                                        <i class="fas fa-cart-plus me-1"></i> Add to Cart
                                                    </button>
                                                </div>
                                            </form>
                                            {% else %}
                                            <a href="{{ url_for('users.login') }}" class="btn btn-outline-primary">
                                                <i class="fas fa-sign-in-alt me-1"></i> Login to Purchase
                                            </a>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                            {% else %}
                            <div class="alert alert-warning">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                This product is currently out of stock from all sellers.
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Product Reviews Card -->
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center border-bottom">
                    <h5 class="mb-0 fw-bold">Customer Reviews ({{ product.review_count }})</h5>
                    {% if current_user.is_authenticated %}
                    <a href="{{ url_for('reviews.add_review', product_id=product.id) }}" class="btn btn-primary">
                        <i class="fas fa-comment me-1"></i> Write a Review
                    </a>
                    {% endif %}
                </div>
                <div class="card-body">
                    {% if product.review_count > 0 %}
                    <!-- Rating Summary -->
                    <div class="row mb-4">
                        <div class="col-md-4 text-center border-end">
                            <h1 class="display-4 fw-bold text-primary">4.7</h1>
                            <div class="mb-2">
                                <i class="fas fa-star text-warning"></i>
                                <i class="fas fa-star text-warning"></i>
                                <i class="fas fa-star text-warning"></i>
                                <i class="fas fa-star text-warning"></i>
                                <i class="fas fa-star-half-alt text-warning"></i>
                            </div>
                            <p class="text-muted">Based on {{ product.review_count }} reviews</p>
                        </div>
                        <div class="col-md-8">
                            <div class="px-4">
                                <!-- 5 Stars -->
                                <div class="d-flex align-items-center mb-2">
                                    <div class="text-nowrap me-3">
                                        <i class="fas fa-star text-warning"></i>
                                        <i class="fas fa-star text-warning"></i>
                                        <i class="fas fa-star text-warning"></i>
                                        <i class="fas fa-star text-warning"></i>
                                        <i class="fas fa-star text-warning"></i>
                                    </div>
                                    <div class="progress flex-grow-1" style="height: 8px;">
                                        <div class="progress-bar bg-success" role="progressbar" style="width: 65%"></div>
                                    </div>
                                    <span class="ms-3 text-muted">65%</span>
                                </div>

                                <!-- 4 Stars -->
                                <div class="d-flex align-items-center mb-2">
                                    <div class="text-nowrap me-3">
                                        <i class="fas fa-star text-warning"></i>
                                        <i class="fas fa-star text-warning"></i>
                                        <i class="fas fa-star text-warning"></i>
                                        <i class="fas fa-star text-warning"></i>
                                        <i class="far fa-star text-warning"></i>
                                    </div>
                                    <div class="progress flex-grow-1" style="height: 8px;">
                                        <div class="progress-bar bg-success" role="progressbar" style="width: 20%"></div>
                                    </div>
                                    <span class="ms-3 text-muted">20%</span>
                                </div>

                                <!-- 3 Stars -->
                                <div class="d-flex align-items-center mb-2">
                                    <div class="text-nowrap me-3">
                                        <i class="fas fa-star text-warning"></i>
                                        <i class="fas fa-star text-warning"></i>
                                        <i class="fas fa-star text-warning"></i>
                                        <i class="far fa-star text-warning"></i>
                                        <i class="far fa-star text-warning"></i>
                                    </div>
                                    <div class="progress flex-grow-1" style="height: 8px;">
                                        <div class="progress-bar bg-warning" role="progressbar" style="width: 10%"></div>
                                    </div>
                                    <span class="ms-3 text-muted">10%</span>
                                </div>

                                <!-- 2 Stars -->
                                <div class="d-flex align-items-center mb-2">
                                    <div class="text-nowrap me-3">
                                        <i class="fas fa-star text-warning"></i>
                                        <i class="fas fa-star text-warning"></i>
                                        <i class="far fa-star text-warning"></i>
                                        <i class="far fa-star text-warning"></i>
                                        <i class="far fa-star text-warning"></i>
                                    </div>
                                    <div class="progress flex-grow-1" style="height: 8px;">
                                        <div class="progress-bar bg-danger" role="progressbar" style="width: 3%"></div>
                                    </div>
                                    <span class="ms-3 text-muted">3%</span>
                                </div>

                                <!-- 1 Star -->
                                <div class="d-flex align-items-center">
                                    <div class="text-nowrap me-3">
                                        <i class="fas fa-star text-warning"></i>
                                        <i class="far fa-star text-warning"></i>
                                        <i class="far fa-star text-warning"></i>
                                        <i class="far fa-star text-warning"></i>
                                        <i class="far fa-star text-warning"></i>
                                    </div>
                                    <div class="progress flex-grow-1" style="height: 8px;">
                                        <div class="progress-bar bg-danger" role="progressbar" style="width: 2%"></div>
                                    </div>
                                    <span class="ms-3 text-muted">2%</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <hr>

                    <!-- Featured Reviews - Exactly 3 reviews displayed -->
                    <h6 class="text-uppercase text-muted mb-3">Top Reviews</h6>

                    <!-- Review 1 -->
                    <div class="card border-0 mb-3">
                        <div class="card-body p-0">
                            <div class="d-flex mb-2">
                                <div class="flex-shrink-0">
                                    <div class="bg-light rounded-circle d-flex align-items-center justify-content-center" style="width: 50px; height: 50px;">
                                        <i class="fas fa-user text-secondary"></i>
                                    </div>
                                </div>
                                <div class="ms-3">
                                    <h6 class="mb-0 fw-bold">John D.</h6>
                                    <div class="d-flex align-items-center">
                                        <!-- Star Rating -->
                                        <div class="me-2">
                                            <i class="fas fa-star text-warning"></i>
                                            <i class="fas fa-star text-warning"></i>
                                            <i class="fas fa-star text-warning"></i>
                                            <i class="fas fa-star text-warning"></i>
                                            <i class="fas fa-star text-warning"></i>
                                        </div>
                                        <small class="text-muted">Verified Purchase</small>
                                    </div>
                                    <small class="text-muted">March 15, 2024</small>
                                </div>
                                <div class="ms-auto">
                                    <div class="d-flex align-items-center text-muted">
                                        <i class="fas fa-thumbs-up me-1"></i>
                                        <small>42</small>
                                    </div>
                                </div>
                            </div>
                            <p>Absolutely love this product! The quality exceeded my expectations and it works perfectly for my needs. Shipping was quick and the price was reasonable. Highly recommend to anyone looking for this type of item!</p>
                        </div>
                    </div>

                    <!-- Review 2 -->
                    <div class="card border-0 mb-3">
                        <div class="card-body p-0">
                            <div class="d-flex mb-2">
                                <div class="flex-shrink-0">
                                    <div class="bg-light rounded-circle d-flex align-items-center justify-content-center" style="width: 50px; height: 50px;">
                                        <i class="fas fa-user text-secondary"></i>
                                    </div>
                                </div>
                                <div class="ms-3">
                                    <h6 class="mb-0 fw-bold">Sarah M.</h6>
                                    <div class="d-flex align-items-center">
                                        <!-- Star Rating -->
                                        <div class="me-2">
                                            <i class="fas fa-star text-warning"></i>
                                            <i class="fas fa-star text-warning"></i>
                                            <i class="fas fa-star text-warning"></i>
                                            <i class="fas fa-star text-warning"></i>
                                            <i class="far fa-star text-warning"></i>
                                        </div>
                                        <small class="text-muted">Verified Purchase</small>
                                    </div>
                                    <small class="text-muted">February 28, 2024</small>
                                </div>
                                <div class="ms-auto">
                                    <div class="d-flex align-items-center text-muted">
                                        <i class="fas fa-thumbs-up me-1"></i>
                                        <small>18</small>
                                    </div>
                                </div>
                            </div>
                            <p>Great product overall, but I'm taking off one star because the delivery took longer than expected. The quality is excellent though and it works as described. Would buy again from this seller.</p>
                        </div>
                    </div>

                    <!-- Review 3 -->
                    <div class="card border-0 mb-3">
                        <div class="card-body p-0">
                            <div class="d-flex mb-2">
                                <div class="flex-shrink-0">
                                    <div class="bg-light rounded-circle d-flex align-items-center justify-content-center" style="width: 50px; height: 50px;">
                                        <i class="fas fa-user text-secondary"></i>
                                    </div>
                                </div>
                                <div class="ms-3">
                                    <h6 class="mb-0 fw-bold">Michael R.</h6>
                                    <div class="d-flex align-items-center">
                                        <!-- Star Rating -->
                                        <div class="me-2">
                                            <i class="fas fa-star text-warning"></i>
                                            <i class="fas fa-star text-warning"></i>
                                            <i class="fas fa-star text-warning"></i>
                                            <i class="fas fa-star-half-alt text-warning"></i>
                                            <i class="far fa-star text-warning"></i>
                                        </div>
                                        <small class="text-muted">Verified Purchase</small>
                                    </div>
                                    <small class="text-muted">January 10, 2024</small>
                                </div>
                                <div class="ms-auto">
                                    <div class="d-flex align-items-center text-muted">
                                        <i class="fas fa-thumbs-up me-1"></i>
                                        <small>7</small>
                                    </div>
                                </div>
                            </div>
                            <p>This product is pretty good for the price. It does what it's supposed to do, but I wish it had more features. The build quality is decent, and customer service was responsive when I had questions.</p>
                        </div>
                    </div>

                    <div class="text-center mt-4">
                        <a href="{{ url_for('reviews.product_reviews', product_id=product.id) }}" class="btn btn-outline-primary">
                            View All {{ product.review_count }} Reviews
                        </a>
                    </div>
                    {% else %}
                    <div class="text-center py-5">
                        <i class="fas fa-comment-slash fa-3x text-muted mb-3"></i>
                        <h5 class="text-muted">No reviews yet</h5>
                        <p class="text-muted">Be the first to share your thoughts on this product!</p>
                        {% if current_user.is_authenticated %}
                        <a href="{{ url_for('reviews.add_review', product_id=product.id) }}" class="btn btn-primary mt-2">
                            <i class="fas fa-comment me-1"></i> Write a Review
                        </a>
                        {% else %}
                        <a href="{{ url_for('users.login') }}" class="btn btn-outline-primary mt-2">
                            <i class="fas fa-sign-in-alt me-1"></i> Login to Write a Review
                        </a>
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Sidebar Column -->
        <div class="col-md-4">
{#            <!-- Seller Information Card - Dynamic based on selection -->#}
{#            <div class="card shadow-sm mb-4" id="seller-info-card">#}
{#                <div class="card-header bg-white py-3 border-bottom">#}
{#                    <h5 class="mb-0 fw-bold">Seller Information</h5>#}
{#                </div>#}
{#                <div class="card-body">#}
{#                    <div class="d-flex align-items-center mb-3">#}
{#                        <div class="flex-shrink-0">#}
{#                            <div class="bg-light rounded-circle d-flex align-items-center justify-content-center" style="width: 60px; height: 60px;">#}
{#                                <i class="fas fa-user-tie fa-2x text-secondary"></i>#}
{#                            </div>#}
{#                        </div>#}
{#                        <div class="ms-3">#}
{#                            <h5 class="fw-bold mb-1" id="seller-name">Stephanie Thompson</h5>#}
{#                            <div class="d-flex align-items-center">#}
{#                                <div class="me-2">#}
{#                                    <i class="fas fa-star text-warning"></i>#}
{#                                    <span id="seller-rating">4.9</span>#}
{#                                </div>#}
{#                                <span class="text-muted">(<span id="seller-reviews">124</span> ratings)</span>#}
{#                            </div>#}
{#                        </div>#}
{#                    </div>#}
{##}
{#                    <!-- Seller Stats -->#}
{#                    <div class="row text-center mb-3">#}
{#                        <div class="col-4">#}
{#                            <div class="p-2 border rounded">#}
{#                                <h6 class="fw-bold text-primary mb-0"><span id="seller-satisfaction">98</span>%</h6>#}
{#                                <small class="text-muted">Satisfaction</small>#}
{#                            </div>#}
{#                        </div>#}
{#                        <div class="col-4">#}
{#                            <div class="p-2 border rounded">#}
{#                                <h6 class="fw-bold text-primary mb-0" id="seller-response">24h</h6>#}
{#                                <small class="text-muted">Response</small>#}
{#                            </div>#}
{#                        </div>#}
{#                        <div class="col-4">#}
{#                            <div class="p-2 border rounded">#}
{#                                <h6 class="fw-bold text-primary mb-0" id="seller-products">256</h6>#}
{#                                <small class="text-muted">Products</small>#}
{#                            </div>#}
{#                        </div>#}
{#                    </div>#}
{##}
{#                    <a href="{{ url_for('seller.inventory', seller_id=product.inventory[0].seller_id if product.inventory else 0) }}" class="btn btn-outline-primary w-100" id="seller-store-link">#}
{#                        <i class="fas fa-store me-2"></i> View Seller's Store#}
{#                    </a>#}
{#                </div>#}
{#            </div>#}

            <!-- Related Products Card -->
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-white py-3 border-bottom">
                    <h5 class="mb-0 fw-bold">You May Also Like</h5>
                </div>
                <div class="card-body">
                    <div class="list-group list-group-flush">
                        <!-- Related Product 1 -->
                        <a href="{{ url_for('product.product_detail', product_id=1) }}" class="list-group-item list-group-item-action px-0 py-3 border-bottom">
                            <div class="d-flex">
                                <div class="flex-shrink-0" style="width: 60px; height: 60px;">
                                    <div class="bg-light rounded w-100 h-100 d-flex align-items-center justify-content-center">
                                        <i class="fas fa-image text-muted"></i>
                                    </div>
                                </div>
                                <div class="ms-3">
                                    <h6 class="mb-1 text-truncate">Similar Product One</h6>
                                    <div class="d-flex align-items-center mb-1">
                                        <div class="me-2">
                                            <i class="fas fa-star text-warning small"></i>
                                            <i class="fas fa-star text-warning small"></i>
                                            <i class="fas fa-star text-warning small"></i>
                                            <i class="fas fa-star text-warning small"></i>
                                            <i class="fas fa-star-half-alt text-warning small"></i>
                                        </div>
                                        <small class="text-muted">4.5 (78)</small>
                                    </div>
                                    <span class="text-primary fw-medium">$24.99</span>
                                </div>
                            </div>
                        </a>

                        <!-- Related Product 2 -->
                        <a href="{{ url_for('product.product_detail', product_id=2) }}" class="list-group-item list-group-item-action px-0 py-3 border-bottom">
                            <div class="d-flex">
                                <div class="flex-shrink-0" style="width: 60px; height: 60px;">
                                    <div class="bg-light rounded w-100 h-100 d-flex align-items-center justify-content-center">
                                        <i class="fas fa-image text-muted"></i>
                                    </div>
                                </div>
                                <div class="ms-3">
                                    <h6 class="mb-1 text-truncate">Similar Product Two</h6>
                                    <div class="d-flex align-items-center mb-1">
                                        <div class="me-2">
                                            <i class="fas fa-star text-warning small"></i>
                                            <i class="fas fa-star text-warning small"></i>
                                            <i class="fas fa-star text-warning small"></i>
                                            <i class="fas fa-star text-warning small"></i>
                                            <i class="far fa-star text-warning small"></i>
                                        </div>
                                        <small class="text-muted">4.0 (45)</small>
                                    </div>
                                    <span class="text-primary fw-medium">$19.99</span>
                                </div>
                            </div>
                        </a>

                        <!-- Related Product 3 -->
                        <a href="{{ url_for('product.product_detail', product_id=3) }}" class="list-group-item list-group-item-action px-0 py-3">
                            <div class="d-flex">
                                <div class="flex-shrink-0" style="width: 60px; height: 60px;">
                                    <div class="bg-light rounded w-100 h-100 d-flex align-items-center justify-content-center">
                                        <i class="fas fa-image text-muted"></i>
                                    </div>
                                </div>
                                <div class="ms-3">
                                    <h6 class="mb-1 text-truncate">Similar Product Three</h6>
                                    <div class="d-flex align-items-center mb-1">
                                        <div class="me-2">
                                            <i class="fas fa-star text-warning small"></i>
                                            <i class="fas fa-star text-warning small"></i>
                                            <i class="fas fa-star text-warning small"></i>
                                            <i class="fas fa-star text-warning small"></i>
                                            <i class="fas fa-star text-warning small"></i>
                                        </div>
                                        <small class="text-muted">5.0 (32)</small>
                                    </div>
                                    <span class="text-primary fw-medium">$29.99</span>
                                </div>
                            </div>
                        </a>
                    </div>

                    <a href="{{ url_for('index.index') }}" class="btn btn-outline-primary w-100 mt-3">
                        <i class="fas fa-search me-1"></i> View More Similar Products
                    </a>
                </div>
            </div>

            <!-- Recently Viewed -->
            <div class="card shadow-sm">
                <div class="card-header bg-white py-3 border-bottom">
                    <h5 class="mb-0 fw-bold">Recently Viewed</h5>
                </div>
                <div class="card-body">
                    <div class="row row-cols-2 g-2">
                        <!-- Recently Viewed 1 -->
                        <div class="col">
                            <a href="{{ url_for('product.product_detail', product_id=4) }}" class="text-decoration-none">
                                <div class="card h-100 border">
                                    <div class="bg-light d-flex align-items-center justify-content-center p-2" style="height: 80px;">
                                        <i class="fas fa-image text-muted"></i>
                                    </div>
                                    <div class="card-body p-2">
                                        <p class="mb-0 text-truncate small">Product Name</p>
                                        <span class="text-primary small">$15.99</span>
                                    </div>
                                </div>
                            </a>
                        </div>

                        <!-- Recently Viewed 2 -->
                        <div class="col">
                            <a href="{{ url_for('product.product_detail', product_id=5) }}" class="text-decoration-none">
                                <div class="card h-100 border">
                                    <div class="bg-light d-flex align-items-center justify-content-center p-2" style="height: 80px;">
                                        <i class="fas fa-image text-muted"></i>
                                    </div>
                                    <div class="card-body p-2">
                                        <p class="mb-0 text-truncate small">Product Name</p>
                                        <span class="text-primary small">$22.50</span>
                                    </div>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript for Dynamic Seller Selection -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Get all seller option elements
        const sellerOptions = document.querySelectorAll('.seller-option');
        const sellerNameElement = document.getElementById('seller-name');
        const sellerRatingElement = document.getElementById('seller-rating');
        const sellerReviewsElement = document.getElementById('seller-reviews');
        const sellerSatisfactionElement = document.getElementById('seller-satisfaction');
        const sellerResponseElement = document.getElementById('seller-response');
        const sellerProductsElement = document.getElementById('seller-products');
        const sellerStoreLink = document.getElementById('seller-store-link');

        // Set default selected seller (first one)
        let selectedSellerId = sellerOptions.length > 0 ? sellerOptions[0].dataset.sellerId : null;

        // Add click event to all seller options
        sellerOptions.forEach(option => {
            option.addEventListener('click', function(e) {
                // Prevent form submission when clicking the row
                if (e.target.tagName !== 'BUTTON' && e.target.tagName !== 'INPUT') {
                    e.preventDefault();

                    // Remove highlight from all options
                    sellerOptions.forEach(opt => {
                        opt.classList.remove('border-start', 'border-3', 'border-primary');
                        opt.querySelector('.seller-badge')?.classList.add('d-none');
                    });

                    // Add highlight to selected option
                    this.classList.add('border-start', 'border-3', 'border-primary');
                    const badge = this.querySelector('.seller-badge');
                    if (badge) badge.classList.remove('d-none');

                    // Update seller info
                    selectedSellerId = this.dataset.sellerId;
                    sellerNameElement.textContent = this.dataset.sellerName;
                    sellerRatingElement.textContent = this.dataset.sellerRating;
                    sellerReviewsElement.textContent = this.dataset.sellerReviews;
                    sellerSatisfactionElement.textContent = this.dataset.sellerSatisfaction;
                    sellerResponseElement.textContent = this.dataset.sellerResponse;
                    sellerProductsElement.textContent = this.dataset.sellerProducts;

                    // Update store link
                    sellerStoreLink.href = `/seller/inventory?seller_id=${selectedSellerId}`;

                    // Find the button in this seller option and style it as primary
                    const buttons = document.querySelectorAll('.select-seller-btn');
                    buttons.forEach(btn => {
                        btn.classList.remove('btn-primary');
                        btn.classList.add('btn-outline-primary');
                    });

                    const thisButton = this.querySelector('.select-seller-btn');
                    if (thisButton) {
                        thisButton.classList.remove('btn-outline-primary');
                        thisButton.classList.add('btn-primary');
                    }
                }
            });
        });

        // Make "Add to Cart" buttons also select the seller
        const addToCartButtons = document.querySelectorAll('.select-seller-btn');
        addToCartButtons.forEach(button => {
            button.addEventListener('click', function() {
                const sellerOption = this.closest('.seller-option');
                if (sellerOption) {
                    // Manually trigger the click event on the parent
                    const event = new MouseEvent('click', {
                        bubbles: true,
                        cancelable: true,
                        view: window
                    });
                    sellerOption.dispatchEvent(event);
                }
            });
        });
    });
</script>
{% endblock %}